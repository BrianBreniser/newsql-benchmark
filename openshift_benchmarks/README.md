# apply_templating.py

- Uses Python3 in #!/usr/bin/env python3, this should find the python3 interpreter on your system.
- RUN: `./apply_templating.py <config name>` from this directory.
    - WARNING: This will overwrite the yaml files in this directory. If you have made changes to them, they will be lost.
    - To find the config options, open the templates/values.json directory. It's the top level keys in the json file.
    - The README.md in the templates directory has more information on how the templates work
- This script was hand-written for its task, and is not a generic templating script. It is not intended to be used for other purposes. It serves it's purpose well
- Running the script will dump the output of the yaml files in the current directory
- These yaml files are used by setup_script.sh to install the components on the openshift cluster

# setup_script.sh

- The setup script runs `oc` commands to instll the necessary components on the openshift cluster.
- RUN: Log into the openshift cluster using the `oc login` command. run './setup_script.sh' from thid directory.
- Some components in this script do not require YAML files, and are installed directly using the `oc` command. Or are operators that are installed using the operator hub.

# azure_localstorage_setup_config/

- Was used in testing to setup a local storage operator on Azure L-Series vms. This is not needed for the demo, but is left here for reference.

# fdb-kubernetes-operator/

- This is the foundationdb operator that is installed on the openshift cluster.
- I embedded the entire project here, because the operator is not available anywhere else, and Apples site where the operator should be hosted (according to the README files in the source code) is no longer up and hosting the files.

# templates/

- Holds the tempates and values.json file that are used by the apply_templating.py script

# *.yaml

- All yaml files in this directory are generated by the apply_templating.py script. They should not be edited directly. The templates should be edited instead and the `apply_templating.py` command run to replace them.

# How to add a new name_template.yaml file

- Some steps are required to adda a new templated yaml file to the list of generated files
    - 1: Add the new name_template.yaml file to the `templates` directory
    - 2: Update the tempate_list in the `apply_templating.py` script to include the new template files (All values will be in values.json for now, even though it is configurable)
    - 3: Add the config options to the templates/values.json file with any template values you added to the name_template.yaml file
    - 4: Add the new yaml file (The final name) to the .gitignore file (so you don't keep committing minor edits to git)

# YCSB notes

## Found these in the ansible configs
- ycsb_cmd: "sh {{ycsb_dir}}/bin/ycsb.sh
    - {{ycsb_operation}} // probably load or run based on loadgen_workload_name being 'insert' or not
    - {{ycsb_binding_name}} // 'fdb' 
    - -s -P {{ycsb_dir}}/workloads/{{ycsb_workload_name}} // either 'workloada' or 'workloadb' // based on loadgen_workload_name being 'insert' or not
    - {{ycsb_params}} >> {{loadgen_log_file}} 2>&1" // see below

- ycsb_params: 
    - {{ycsb_db_specific_params}} // -p foundationdb.apiversion=620 -p foundationdb.clusterfile=/etc/foundationdb/fdb.cluster -p foundationdb.batchsize=100'
        - is 620 still a correct apiversion?
    - {{ycsb_insert_params}}
        - ycsb_insert_params: "{% if loadgen_workload_name == 'insert' %} -p insertstart={{ loadgen_start_key_per_host_process | int }} -p insertcount={{ loadgen_keys_per_process| int }} -p operationcount={{( (loadgen_keys_per_process | int) / loadgen_batch_size | int) |int}}{% else %} -p operationcount={{ ycsb_op_count }} {% endif %}"
            - loadgen_keys_per_process: "{{ ((loadgen_keys_per_host | int)/ (loadgen_process_per_host|int)) | int}}"
    - -p recordcount={{loadgen_num_keys}} // 1000000
    - -p readproportion={{ycsb_read_proportion}} // workoad config, 0-1, what % of operations are read (example, 0.9)
    - -p updateproportion={{ycsb_update_proportion}} // workoad config, 0-1, what % of operations are write (example 0.1)
        - These two values should equal 1, 0.9+0.1, 1.0+0.0, etc.
    - {{ycsb_additional_params}} 
    - -p threadcount={{ loadgen_threads_per_process }} // varied from 1-16 in the configs

- ycsb_additional_params:
    - -p requestdistribution=uniform 
    - -p maxexecutiontime={{ ycsb_max_execution_time_seconds }} // 60 * 60 * 24 * 14 // 2 weeks
    - -p table=usertable
    - -p insertorder=hashed 
    - -p zeropadding=12 
    - -p fieldlength={{ycsb_field_length}} // 2000 
    - -p fieldcount={{ycsb_field_count}} // 1


# Notes on using FDB on kubectl

- fdb analyze












